<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Skyline SVG ç”Ÿæˆå™¨ </title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¨</text></svg>">
    <style>
      :root {
        --primary: #0071e3;
        --bg-gray: #f2f2f2;
        --border: #e5e5e5;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        outline: none;
        font-family: -apple-system, "SF Pro Text", sans-serif;
      }
      body {
        display: flex;
        height: 100vh;
        overflow: hidden;
        background-color: #f7f7f7;
      }

      .editor-panel {
        width: 460px;
        background: white;
        border-right: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        z-index: 10;
        box-shadow: 4px 0 20px rgba(0, 0, 0, 0.05);
      }
      .editor-header {
        padding: 16px 20px;
        border-bottom: 1px solid var(--border);
        background: #fff;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .btn-copy {
        background: #07c160;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: 0.2s;
      }
      .btn-copy:hover {
        background: #06ad56;
        transform: translateY(-1px);
      }
      .editor-content {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        background: #fafafa;
      }

      .form-group {
        background: white;
        padding: 18px;
        border-radius: 12px;
        margin-bottom: 15px;
        border: 1px solid #eee;
      }
      .form-group h3 {
        font-size: 14px;
        color: #1d1d1f;
        margin-bottom: 12px;
        font-weight: 700;
        border-left: 3px solid var(--primary);
        padding-left: 8px;
      }
      .input-row {
        margin-bottom: 12px;
      }
      .input-group {
        display: flex;
        gap: 10px;
      }
      label {
        display: block;
        font-size: 12px;
        margin-bottom: 4px;
        color: #666;
        font-weight: 500;
      }
      input,
      textarea {
        width: 100%;
        padding: 8px 10px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 13px;
        transition: 0.2s;
        background: #fff;
      }
      input:focus,
      textarea:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(0, 113, 227, 0.1);
      }
      textarea {
        min-height: 80px;
        resize: vertical;
        line-height: 1.4;
      }

      .case-ctrl {
        background: white;
        border: 1px solid #eee;
        border-radius: 10px;
        margin-bottom: 15px;
        overflow: hidden;
      }
      .case-head {
        padding: 12px 16px;
        background: #fff;
        display: flex;
        justify-content: space-between;
        cursor: pointer;
        font-size: 13px;
        font-weight: 600;
        align-items: center;
      }
      .case-ctrl.open .case-head {
        background: #f5f5f7;
        border-bottom: 1px solid #eee;
      }
      .case-body {
        padding: 16px;
        display: none;
      }
      .case-ctrl.open .case-body {
        display: block;
      }

      .btn-icon {
        background: none;
        border: none;
        cursor: pointer;
        color: #999;
        margin-left: 8px;
        font-size: 14px;
      }
      .btn-icon:hover {
        color: var(--primary);
      }
      .btn-icon.del:hover {
        color: #ff3b30;
      }
      .btn-add {
        width: 100%;
        padding: 12px;
        background: white;
        color: var(--primary);
        border: 2px dashed var(--primary);
        border-radius: 8px;
        cursor: pointer;
        margin-bottom: 30px;
        font-weight: 600;
        font-size: 13px;
      }

      .preview-panel {
        flex: 1;
        background: #2c2c2c;
        display: flex;
        justify-content: center;
        overflow-y: auto;
        padding: 40px;
      }
      .wx-phone {
        width: 480px;
        background: #fff;
        min-height: 800px;
        padding: 0;
        box-shadow: 0 0 0 10px #111, 0 20px 50px rgba(0, 0, 0, 0.5);
        border-radius: 40px;
        overflow: hidden;
        position: relative;
      }
      .status-bar {
        height: 44px;
        background: #181818;
        width: 100%;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 100;
      }
      #preview-box {
        width: 100%;
        height: 100%;
        background: #fff;
        padding-top: 44px;
        overflow-y: auto;
      }
      #preview-box::-webkit-scrollbar {
        width: 0;
      }
    </style>
  </head>
  <body>
    <div class="editor-panel">
      <div class="editor-header">
        <div style="font-weight: 800; font-size: 16px">
          Skyline Editor
          <span style="color: var(--primary); font-size: 12px">V7.0</span>
        </div>
        <button class="btn-copy" onclick="copySVGCode()">å¤åˆ¶ SVG ä»£ç </button>
      </div>
      <div class="editor-content" id="editor"></div>
    </div>

    <div class="preview-panel">
      <div class="wx-phone">
        <div class="status-bar"></div>
        <div id="preview-box"></div>
      </div>
    </div>

    <script>
      let data = {
        title: "skyline | 2025å¹´åº¦æ¡ˆä¾‹ç²¾é€‰ï¼šæ¢ç´¢æ•°å­—äº¤äº’çš„æ— é™å¯èƒ½",
        cases: [
          {
            title: "KAIKEN æè‡´é£åœŸ",
            sub: "æ²‰æµ¸å¼å“ç‰Œæ•…äº‹ä½“éªŒ",
            tags: "SVG, äº¤äº’å›¾æ–‡",
            img1: "https://images.unsplash.com/photo-1506377247377-2a5b3b417ebb?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            img1_h: 180,
            desc: "é€šè¿‡å¤æ‚çš„SVGè·¯å¾„åŠ¨ç”»ï¼Œæ¨¡æ‹Ÿå®‰ç¬¬æ–¯å±±è„‰çš„æ—¥å‡ºæ—¥è½ã€‚\n\nç”¨æˆ·ç‚¹å‡»å±å¹•ï¼Œå¦‚åŒäº²è‡ªæ­å¼€è¿·é›¾ï¼Œæ¢ç´¢è‘¡è„å›­çš„å¥¥ç§˜ã€‚",
            img2: "https://images.unsplash.com/photo-1534353473418-4cfa6c56fd38?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
            img2_h: 500,
            link: "https://mp.weixin.qq.com",
          },
        ],
        footer: {
          t1: "å¤©é™…å·¥åŠ",
          t2: "SKYLINE STUDIO",
          desc: "å¤©é™…å·¥åŠ(Skyline)ä¸“æ³¨å¾®ä¿¡ç”Ÿæ€åˆ›æ„å®šåˆ¶å¼€å‘ï¼Œæ·±è€•å…¬ä¼—å·SVGäº¤äº’å›¾æ–‡ï¼Œè‡´åŠ›äºä¸ºå“ç‰Œæ‰“é€ ä»¤äººéš¾å¿˜çš„æ•°å­—ä½“éªŒã€‚\n\næˆ‘ä»¬ç›¸ä¿¡å¥½çš„å†…å®¹ä¸æ­¢äºâ€œè¢«çœ‹è§â€ï¼Œæ›´è¦â€œè¢«ä½“éªŒâ€ã€‚åŒæ—¶æä¾›H5åˆ›æ„å¼€å‘å’Œå°ç¨‹åºå®šåˆ¶æœåŠ¡ã€‚",
          copy: "Â© 2021-2025 Skyline Studio",
        },
      };

      const CONFIG = {
        WIDTH: 600,
        PADDING: 40,
        FOOTER_PADDING: 50, // åº•éƒ¨æ–‡å­—çš„å·¦å³è¾¹è· (åŠ å¤§ä¸€ç‚¹æ›´ç¾è§‚)
        FONT_TITLE: 34,
        FONT_SUB: 22,
        FONT_BODY: 26,
        FONT_TAG: 18,
        COLOR_BLUE: "#0071E3",
      };

      // æ ¸å¿ƒç®—æ³•ï¼šæ–‡å­—æ¢è¡Œè®¡ç®—
      function getWrappedLines(text, fontSize, maxWidth) {
        if (!text) return [];
        const maxChars = Math.floor(maxWidth / fontSize);
        let lines = [],
          curLine = "",
          curW = 0;
        for (let char of text) {
          const w = char.charCodeAt(0) > 255 ? 1 : 0.6;
          if (curW + w > maxChars) {
            lines.push(curLine);
            curLine = char;
            curW = w;
          } else {
            curLine += char;
            curW += w;
          }
        }
        if (curLine) lines.push(curLine);
        return lines;
      }

      function generateSVG() {
        let y = 0;
        let content = "";
        const W = CONFIG.WIDTH;
        const P = CONFIG.PADDING;
        const CW = W - P * 2;

        // === 1. å¤´éƒ¨ ===
        const pageTitleLines = getWrappedLines(data.title, 30, W - 80);
        const headerHeight = 60 + pageTitleLines.length * 40;
        content += `<rect x="0" y="0" width="${W}" height="${headerHeight}" fill="#181818" />`;
        pageTitleLines.forEach((line, i) => {
          const lineY = 50 + i * 40;
          content += `<text x="${
            W / 2
          }" y="${lineY}" font-size="30" fill="#fff" font-weight="bold" text-anchor="middle">${line}</text>`;
        });
        y += headerHeight;

        // === 2. æ¡ˆä¾‹å†…å®¹ ===
        data.cases.forEach((item, idx) => {
          y += 50;

          // åºå·
          content += `<text x="${P}" y="${
            y + 30
          }" font-size="50" fill="#E5E5E5" font-weight="900" style="font-family:Arial">${
            idx + 1
          }</text>`;

          const infoX = P + 50;
          const titleMaxW = W - infoX - P;

          // æ ‡é¢˜
          const titleLines = getWrappedLines(
            item.title,
            CONFIG.FONT_TITLE,
            titleMaxW
          );
          titleLines.forEach((line, i) => {
            content += `<text x="${infoX}" y="${y + 10 + i * 44}" font-size="${
              CONFIG.FONT_TITLE
            }" fill="#1D1D1F" font-weight="bold">${line}</text>`;
          });
          y += titleLines.length * 44 + 10;

          // å‰¯æ ‡é¢˜
          const subLines = getWrappedLines(
            item.sub,
            CONFIG.FONT_SUB,
            titleMaxW
          );
          subLines.forEach((line, i) => {
            content += `<text x="${infoX}" y="${y + 10 + i * 30}" font-size="${
              CONFIG.FONT_SUB
            }" fill="#86868B">${line}</text>`;
          });
          y += subLines.length * 30 + 20;

          // æ ‡ç­¾
          if (item.tags) {
            const tags = item.tags.split(/[,ï¼Œ]/);
            let tagX = infoX;
            tags.forEach((t) => {
              t = t.trim();
              if (!t) return;
              const tw = t.length * CONFIG.FONT_TAG + 24;
              if (tagX + tw > W - P) return;
              content += `<rect x="${tagX}" y="${y}" width="${tw}" height="32" rx="8" fill="#EFF6FF" />`;
              content += `<text x="${tagX + 12}" y="${y + 22}" font-size="${
                CONFIG.FONT_TAG
              }" fill="${CONFIG.COLOR_BLUE}" font-weight="bold">${t}</text>`;
              tagX += tw + 12;
            });
            y += 50;
          }
          y += 15;

          // æ¨ªå›¾
          const h1 = parseInt(item.img1_h) || 180;
          content += `<image x="${P}" y="${y}" width="${CW}" height="${h1}" href="${item.img1}" preserveAspectRatio="xMidYMid slice" clip-path="inset(0% round 12px)" />`;
          y += h1 + 30;

          // æ­£æ–‡
          const paragraphs = item.desc.split("\n");
          paragraphs.forEach((para) => {
            if (para.trim() === "") {
              y += 20;
            } else {
              const lines = getWrappedLines(para, CONFIG.FONT_BODY, CW);
              lines.forEach((line) => {
                content += `<text x="${P}" y="${y + 18}" font-size="${
                  CONFIG.FONT_BODY
                }" fill="#333" style="line-height:1.6">${line}</text>`;
                y += 44;
              });
              y += 10;
            }
          });
          y += 20;

          // ç«–å›¾
          const h2 = parseInt(item.img2_h) || 500;
          content += `<image x="${P}" y="${y}" width="${CW}" height="${h2}" href="${item.img2}" preserveAspectRatio="xMidYMid slice" clip-path="inset(0% round 12px)" />`;
          y += h2 + 15;

          // æç¤º
          content += `<text x="${W / 2}" y="${
            y + 20
          }" font-size="18" fill="#AAA" text-anchor="middle">â–² æ¡ˆä¾‹æ¼”ç¤º GIF</text>`;
          y += 50;

          // æŒ‰é’®
          if (item.link) {
            const btnW = 220;
            const btnH = 52;
            const btnX = (W - btnW) / 2;
            content += `
                <a href="${item.link}" target="_blank">
                    <rect x="${btnX}" y="${y}" width="${btnW}" height="${btnH}" rx="${
              btnH / 2
            }" fill="white" stroke="${CONFIG.COLOR_BLUE}" stroke-width="2" />
                    <text x="${W / 2}" y="${y + 34}" font-size="20" fill="${
              CONFIG.COLOR_BLUE
            }" text-anchor="middle" font-weight="bold" letter-spacing="1">æŸ¥çœ‹å“ç‰Œæ¡ˆä¾‹ â†’</text>
                </a>`;
            y += btnH + 40;
          }

          content += `<line x1="${W / 2 - 20}" y1="${y}" x2="${
            W / 2 + 20
          }" y2="${y}" stroke="#EEE" stroke-width="4" stroke-linecap="round"/>`;
          y += 30;
        });

        y += 40;

        // === 3. åº•éƒ¨ (é«˜åº¦è®¡ç®— & å·¦å¯¹é½ä¼˜åŒ–) ===

        let footerInnerY = 0;
        const fPaddingTop = 80;
        const fPaddingBottom = 60;
        const footerTextWidth = W - CONFIG.FOOTER_PADDING * 2; // æ–‡å­—åŒºåŸŸå®½åº¦ (600 - 100 = 500)

        // å›ºå®šå…ƒç´ é«˜åº¦
        footerInnerY += fPaddingTop;
        footerInnerY += 35; // ä¸»æ ‡é¢˜
        footerInnerY += 25; // å‰¯æ ‡é¢˜
        footerInnerY += 50; // çº¿æ¡

        // ç®€ä»‹è®¡ç®—
        const footLinesRaw = data.footer.desc.split("\n");
        let calculatedDescLines = [];
        footLinesRaw.forEach((para) => {
          if (para.trim() === "") {
            calculatedDescLines.push("__EMPTY__");
          } else {
            // ä½¿ç”¨ 500px å®½åº¦è®¡ç®—æ¢è¡Œ
            const lines = getWrappedLines(para, 22, footerTextWidth);
            calculatedDescLines = calculatedDescLines.concat(lines);
          }
        });

        calculatedDescLines.forEach((line) => {
          if (line === "__EMPTY__") footerInnerY += 15;
          else footerInnerY += 34;
        });

        footerInnerY += 60; // é—´è·
        footerInnerY += 20; // ç‰ˆæƒ
        footerInnerY += fPaddingBottom;

        // ç»˜åˆ¶èƒŒæ™¯
        content += `<rect x="0" y="${y}" width="${W}" height="${footerInnerY}" fill="#181818" />`;

        // ç»˜åˆ¶å†…å®¹
        let fy = y + fPaddingTop;

        // æ ‡é¢˜ä¿æŒå±…ä¸­
        content += `<text x="${
          W / 2
        }" y="${fy}" font-size="36" fill="#fff" font-weight="bold" text-anchor="middle">${
          data.footer.t1
        }</text>`;
        fy += 35;
        content += `<text x="${
          W / 2
        }" y="${fy}" font-size="18" fill="#888" letter-spacing="2" text-anchor="middle" font-family="Arial">${
          data.footer.t2
        }</text>`;
        fy += 25;
        content += `<rect x="${
          W / 2 - 20
        }" y="${fy}" width="40" height="4" fill="${
          CONFIG.COLOR_BLUE
        }" rx="2" />`;
        fy += 50;

        // ç®€ä»‹ï¼šæ”¹ä¸ºå·¦å¯¹é½ (text-anchor="start")ï¼ŒXåæ ‡è®¾ä¸º 50
        calculatedDescLines.forEach((line) => {
          if (line === "__EMPTY__") {
            fy += 15;
          } else {
            content += `<text x="${CONFIG.FOOTER_PADDING}" y="${fy}" font-size="22" fill="#AAA" text-anchor="start">${line}</text>`;
            fy += 34;
          }
        });

        fy += 60;
        content += `<text x="${
          W / 2
        }" y="${fy}" font-size="18" fill="#555" text-anchor="middle">${
          data.footer.copy
        }</text>`;

        const totalHeight = y + footerInnerY;

        return `<svg width="100%" viewBox="0 0 ${W} ${totalHeight}" xmlns="http://www.w3.org/2000/svg" style="background:#fff; display:block; margin:0 auto;">${content}</svg>`;
      }

      function renderEditor() {
        const el = document.getElementById("editor");
        el.innerHTML = "";
        el.innerHTML += `<div class="form-group"><h3>é¡µé¢é…ç½®</h3><div class="input-row"><label>é¡µé¢æ ‡é¢˜ (è‡ªåŠ¨æ¢è¡Œ)</label><input value="${data.title}" oninput="upd('title', this.value)"></div></div>`;

        data.cases.forEach((c, i) => {
          const item = document.createElement("div");
          item.className = "case-ctrl";
          item.innerHTML = `
                <div class="case-head" onclick="toggle(this)">#${i + 1} ${
            c.title
          }<div><button class="btn-icon" onclick="move(${i},-1,event)">â†‘</button><button class="btn-icon" onclick="move(${i},1,event)">â†“</button><button class="btn-icon del" onclick="del(${i},event)">Ã—</button></div></div>
                <div class="case-body">
                    <div class="input-row"><label>æ ‡é¢˜ (è‡ªåŠ¨æ¢è¡Œ)</label><input value="${
                      c.title
                    }" oninput="updCase(${i},'title',this.value)"></div>
                    <div class="input-row"><label>å‰¯æ ‡é¢˜ (è‡ªåŠ¨æ¢è¡Œ)</label><input value="${
                      c.sub
                    }" oninput="updCase(${i},'sub',this.value)"></div>
                    <div class="input-row"><label>æ ‡ç­¾</label><input value="${
                      c.tags
                    }" oninput="updCase(${i},'tags',this.value)"></div>
                    <div class="input-row"><label>æ¨ªå›¾ (é“¾æ¥|é«˜åº¦)</label><div class="input-group"><input style="flex:3" value="${
                      c.img1
                    }" oninput="updCase(${i},'img1',this.value)"><input style="flex:1" type="number" value="${
            c.img1_h || 180
          }" oninput="updCase(${i},'img1_h',this.value)"></div></div>
                    <div class="input-row"><label>æ–‡æ¡ˆ (æ”¯æŒå›è½¦)</label><textarea oninput="updCase(${i},'desc',this.value)">${
            c.desc
          }</textarea></div>
                    <div class="input-row"><label>ç«–å›¾ (é“¾æ¥|é«˜åº¦)</label><div class="input-group"><input style="flex:3" value="${
                      c.img2
                    }" oninput="updCase(${i},'img2',this.value)"><input style="flex:1" type="number" value="${
            c.img2_h || 500
          }" oninput="updCase(${i},'img2_h',this.value)"></div></div>
                    <div class="input-row"><label>è·³è½¬é“¾æ¥</label><input value="${
                      c.link || ""
                    }" oninput="updCase(${i},'link',this.value)"></div>
                </div>`;
          el.appendChild(item);
        });
        el.innerHTML += `<button class="btn-add" onclick="add()">+ æ·»åŠ æ–°æ¡ˆä¾‹</button>`;
        el.innerHTML += `<div class="form-group"><h3>åº•éƒ¨ç‰ˆæƒ</h3><div class="input-row"><label>ä¸»æ ‡é¢˜</label><input value="${data.footer.t1}" oninput="updFoot('t1',this.value)"></div><div class="input-row"><label>å‰¯æ ‡é¢˜</label><input value="${data.footer.t2}" oninput="updFoot('t2',this.value)"></div><div class="input-row"><label>ä»‹ç»æ–‡æ¡ˆ (å·¦å¯¹é½)</label><textarea oninput="updFoot('desc',this.value)">${data.footer.desc}</textarea></div><div class="input-row"><label>Copyright</label><input value="${data.footer.copy}" oninput="updFoot('copy',this.value)"></div></div>`;
        renderPreview();
      }

      function renderPreview() {
        document.getElementById("preview-box").innerHTML = generateSVG();
      }
      function upd(k, v) {
        data[k] = v;
        renderPreview();
      }
      function updCase(i, k, v) {
        data.cases[i][k] = v;
        renderPreview();
      }
      function updFoot(k, v) {
        data.footer[k] = v;
        renderPreview();
      }
      function toggle(el) {
        document.querySelectorAll(".case-ctrl").forEach((c) => {
          if (c !== el.parentElement) c.classList.remove("open");
        });
        el.parentElement.classList.toggle("open");
      }
      function add() {
        data.cases.push({
          title: "æ–°æ¡ˆä¾‹",
          sub: "ç®€ä»‹",
          tags: "æ ‡ç­¾",
          img1: "https://via.placeholder.com/800x400",
          img1_h: 180,
          desc: "æ–‡æ¡ˆ...",
          img2: "https://via.placeholder.com/600x800",
          img2_h: 500,
          link: "",
        });
        renderEditor();
      }
      function del(i, e) {
        e.stopPropagation();
        if (confirm("åˆ é™¤ï¼Ÿ")) {
          data.cases.splice(i, 1);
          renderEditor();
        }
      }
      function move(i, dir, e) {
        e.stopPropagation();
        if (i + dir < 0 || i + dir >= data.cases.length) return;
        [data.cases[i], data.cases[i + dir]] = [
          data.cases[i + dir],
          data.cases[i],
        ];
        renderEditor();
      }
      function copySVGCode() {
        const svg = generateSVG().replace(/[\r\n]+/g, "");
        navigator.clipboard.writeText(svg).then(() => alert("ä»£ç å·²å¤åˆ¶ï¼"));
      }

      renderEditor();
    </script>
  </body>
</html>
